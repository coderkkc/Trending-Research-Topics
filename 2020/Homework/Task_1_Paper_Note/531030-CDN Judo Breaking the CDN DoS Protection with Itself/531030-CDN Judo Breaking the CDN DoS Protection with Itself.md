#### 论文阅读笔记|CDN Judo: Breaking the CDN DoS Protection with Itself

#### 作者

Run Guo  , Weizhong Li ,  Baojun Liu , Shuang Hao  , Jia Zhang ,
Haixin Duan , Kaiwen Shen , Jianjun Chen  , Ying Liu 

#### 简要

本篇论文主要是研究对于CDN的DOS攻击可行性。论文首先是介绍了CDN(内容分发网络)正在被广泛应用，因为CDN通过其全球分布的网络基础设施提高了网站的访问性能和可用性，所以越来越多的网站重要业务或重要服务架设在CDN上。CDN同时可以凭借其巨大的带宽资源吸收DDOS攻击流量，因此CDN被看作是网站解决DDOS攻击的有效措施。

但是，论文却揭示了可以利用CDN转发机制中的协议弱点和漏洞来破坏CDN。通过发送精心构造但合法的请求，攻击者可以针对其背后的网站发起有效的DoS攻击。除此之外，论文提出了三种CDN威胁。通过滥用CDN的HTTP / 2请求转换行为和HTTP Pre-POST行为，攻击者可以使CDN起源的带宽饱和，并耗尽连接限制。论文同时指出，某些CDN供应商仅使用少量的具有较低IP转换速率的流量转发IP来建立与源IP的连接。仅通过切断特定于CDN的连接，此特征就为攻击者提供了一个有效的机会来有效降低网站的全球可用性。

针对上述提出的CDN漏洞，论文深入分析了六家CDN供应商之间的CDN请求转发行为，并针对各个攻击模型进行了实验来评估威胁的严重性。

#### CDN的三个威胁

论文中提到针对CDN攻击的三种手段。

1. ##### HTTP / 2带宽放大攻击。

   CDN在客户端CDN连接中仅支持HTTP / 2，因此攻击者可以滥用CDN的HTTP / 2-HTTP / 1.1转换行为来对源发起带宽放大攻击。论文分析了HTTP / 2引入的HPACK压缩机制，该机制增加了受攻击的风险，并且还揭示了可以滥用并发流和HTTP / 2的Huffman编码来进一步提高带宽放大因子。

2. ##### Pre-POST的慢速HTTP攻击。

   论文分析了六个CDN供应商，有三个在刚收到POST报头时就开始转发HTTP POST请求，而无需等待整个POST消息主体。可以滥用此POST前行为来耗尽来源的连接限制，并使其他合法用户的请求饿死，从而导致针对来源的HTTP DoS攻击缓慢。除此之外，这些CDN的HTTP / 1.1 POST转发和HTTP / 2 POST转发行为都容易受到此威胁的影响。

3. ##### 全球可用性下降攻击

   通过向每个CDN的全局代理IP（进入IP）发送请求以模拟全局客户端访问，我们对每个CDN的转发IP（出口IP）的分布进行了大规模测量。结果表明，CDN将分配少量出口IP来访问源，从而降低IP转换率。因此，攻击者仅通过切断一个或一小套CDN与源IP的连接就可以利用此特性有效地降低由CDN驱动的网站的可用性，从而阻止大多数全球客户端访问该网站的服务。



#### 实验

1. ##### HTTP / 2带宽放大攻击。

   实验中，为了探索并发流对放大率的影响，更改了一个HTTP / 2连接中的并发流数，并使用tcpdump捕获了客户端CDN连接和CDN起源连接中的流量以进行评估放大因子。当并发流数量增加时，带宽放大率也增加。当并发流的数量增加时，数据包的放大率也会增加。当并发流达到一个HTTP / 2连接的最大允许数目时，放大率达到最大。当流的数量超过一个HTTP / 2连接的最大允许数量时，HTTP / 2客户端必须等待之前的流关闭，并且数据包比率下降同时，在达到允许的并发流的最大数量之后，带宽放大率会变化。

   

2. ##### Pre-POST的慢速HTTP攻击。

   实验通过CloudFront，Fastly和MaxCDN持续300 s评估了针对自主构建的原始Web服务器（连接限制为1000）的此类Pre-POST攻击。作为普通客户端，每5 s定期测量一次客户端-CDN-发起请求延迟，以探查CDN与源的连接资源是否耗尽。对于CloudFront和Fastly，为了用尽原来的1000个连接限制，我们同时向CDN发送1100个慢速POST请求,连接资源已用尽。对于CloudFront，普通客户端的请求延迟上升到90 s（返回HTTP 504网关超时），而对于Fastly（返回HTTP 503服务不可用）则上升到15 s，证明了DoS的成功。

   

3. **全球可用性降级攻击**

   实验中，首先建立一个原始服务器，它将记录传入的出口IP和请求的URL。从客户端，直接将请求发送到找到的所有入口IP。这些请求带有不同的查询字符串，以避免CDN的缓存命中，例如http：//IngressIP1/i.php？IngressIP1。然后，CDN通过不同的出口IP将这些请求转发到原始服务器。最后，从原始服务器上记录的数据中，收集出口IP并从URL查询字符串中提取相应的入口IP。通过入侵路径上的网络基础设施（例如路由器或防火墙）或发起交叉攻击来阻止出口节点的Internet连接，从而切断一个或一小套CDN与源IP的连接。

   

#### 创新点

1. 研究的问题很新颖，一般认为CDN能够抵御DDOS攻击，CDN就像防御DDOS攻击的盾，该篇论文直接针对CDN本身尝试攻击，根据目前CDN厂商存在的问题提出了三种攻击方式
2. 对于CDN宣称支持的HTTP2协议入手，论文对于CDN中的协议转换漏洞进行了深入研究，发现CDN在HTTP2到HTTP1.1协议转换时，当CDN将这些请求转发到源主机时，必须将在HTTP / 2中索引的所有标头字段扩展为HTTP / 1.1请求，从而导致带宽放大，论文研究了带宽放大的问题，针对此问题设计实验进行定量计算放大率。
3. 同时针对缓慢HTTP攻击，本论文也进行了深入的研究。通常，由于CDN分离了客户端和源主机的连接，因此CDN自然可以防御传统的缓慢POST攻击。但是，通过实验，论文发现六个CDN中的三个仅在接收到POST标头后就开始转发HTTP POST请求，而无需等待整个POST消息主体。论文发现，这种Pre-POST的行为使攻击者能够将CDN原始连接保持尽可能长的打开时间，从而使攻击者可以耗尽原始连接的限制。
4. 对于要验证的三种攻击模型，论文中分别搭建了环境进行实现，定量的数据更能证明开始提出的三种攻击模型。

   

#### 不足

1. 虽然论文自己搭建了模拟环境，进行实验，但是还是不是真正的商业使用的网站环境，实际条件下攻击效果的可能还需要再进行测试
2. 论文中提到，因为合法问题，实验是在谨慎条件下进行的，并向六家CDN厂商发送了报告。其实可以进一步寻求与相应的CDN厂商合作，搭建商业的测试环境，测试放开条件下的攻击效果
3. 对于那个GFW附带攻击，主要是通过让GFW把CDN IP添加进入黑名单来达到拒绝服务的目的，忽略了GFW和CDN厂商可能已经建立的白名单等机制。



